<!DOCTYPE html>
<html lang="en">
	<head>
		<title>Add/Remove Question</title>
		<link href="css/main.css" rel="stylesheet">
	</head>

	<body>
		<div class="color-main1">
	        <a href="instructor.html" class="color-main1 nav-bar">home</a>
	    </div>

		<div class="center">
			<h2>Add a Question</h2><hr>
		</div>

		<div class="container center color-main2">
		    <form class="left-align">
		    	Question<br>
		    	<textarea rows="10" type="text" id="question" class="input-question" placeholder="Type your question"></textarea><br>
		    	Answer<br>
		    	<textarea rows="10" type="text" id="answer" class="input-question" placeholder="Type the answer"></textarea><br>
				Parameters<br>
		    	<textarea rows="10" type="text" id="params" class="input-question" placeholder="Type any specific parameters"></textarea><br>
		    </form>
		    	
		    <button type="button" class="button color-bold1" onclick="addQuestion()">Add Question</button>
		</div> 

		<hr>

		<div class="center">
			<h2>Remove Questions</h2><hr>
		</div>
		<div class="container color-main2 left-align" id="qlist"></div> 
        <div class="center">
            <button type="button" class="button center color-bold1" onclick="removeQuestions()">Remove</button>    
        </div>
        
		<script type="text/javascript">
			function addQuestion(){
				var xmlhttp = new XMLHttpRequest();
                xmlhttp.onreadystatechange = function() {
                    if (this.readyState == 4) {
                    	window.location.reload(false);
                    }
                };

                var qtext = document.getElementById("question").value;
                var atext = document.getElementById("answer").value;
                var ptext = document.getElementById("params").value;

                if(qtext == "" || atext == "" || ptext == ""){
                    alert("Please fill out missing fields in question form!");
                    return;
                }

                var jsonData = {
                	"question" : qtext,
                	"answer" : atext,
                	"params" : ptext
                };

                xmlhttp.open("POST", "https://web.njit.edu/~smc53/cs490/request-generic.php?request=AddQuestion&username=" + window.localStorage.getItem('username') + "&payload=" + JSON.stringify(jsonData));
                xmlhttp.send();
			}

            function fillQuestionList(testjson){
                var json = JSON.parse(testjson);
                var list = document.getElementById("qlist");
                for(var i = 0; i < json.questions.length; i++){
                    var qelement = JSON.parse(json.questions[i]);
                    var entry = document.createElement('input');
                    entry.className = 'qfield';
                    entry.value = qelement.ID;
                    entry.type = 'checkbox';
                    list.appendChild(entry);
                    list.appendChild(document.createTextNode(qelement.question));
                    list.appendChild(document.createElement('br'));
                }
            }

            function removeQuestions(){
                var inputElements = document.getElementsByClassName('qfield');
                for(var i=0; inputElements[i]; ++i){
                    if(inputElements[i].checked){
                        var jsonData = {
                            "questionID" : inputElements[i].value,
                        }
                        var json = JSON.stringify(jsonData);
                        console.log("REMOVE Q json: " + json);

                        var xmlhttp = new XMLHttpRequest();
                        xmlhttp.onreadystatechange = function() {
                            if (this.readyState == 4) {
                                window.location.reload(false);
                            }
                        };
                        xmlhttp.open("POST", "https://web.njit.edu/~smc53/cs490/request-generic.php?request=RemoveQuestion&username=" + window.localStorage.getItem('username') + "&payload=" + json);
                        xmlhttp.send();
                    }
                }
            }

			function loadRequest(){
                var xmlhttp = new XMLHttpRequest();
                xmlhttp.onreadystatechange = function() {
                    if (this.readyState == 4) {
                        fillQuestionList(this.responseText);
                    }
                };

                xmlhttp.open("POST", "https://web.njit.edu/~smc53/cs490/request-generic.php?request=GetQuestions");
                xmlhttp.send();
            }

            window.onload = function(){
                loadRequest();
			}	
		</script>
	</body>
</html>